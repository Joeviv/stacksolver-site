---
// ARCHIVO: src/pages/servicios/[sectionId]/[subsectionId].astro
import Layout from '../../../layouts/Layout.astro';
import { SERVICES_MENU } from '../../../data/menuData';
import { ProjectGantt } from '../../../components/ProjectGantt';
import { 
  CheckCircleIcon, 
  ClockIcon, 
  WrenchScrewdriverIcon, 
  ChevronRightIcon 
} from '@heroicons/react/24/outline';

// 1. Generación de rutas estáticas (SEO Friendly)
export async function getStaticPaths() {
  const paths = [];
  
  SERVICES_MENU.forEach(section => {
    section.subsections.forEach(sub => {
      paths.push({
        params: { 
          sectionId: section.id, 
          subsectionId: sub.id 
        },
        props: { 
          section, 
          subsection: sub 
        },
      });
    });
  });
  
  return paths;
}

// 2. Obtener datos de la página actual
const { section, subsection } = Astro.props;
const { title, fullDescription, features, image, implementationPlan, techBadge, shortDescription } = subsection;
---

<Layout title={`${title} | StackSolver Services`} description={shortDescription}>
  <div class="p-6 md:p-12 lg:p-16 max-w-7xl mx-auto w-full animate-in fade-in duration-500">
    
    {/* Breadcrumbs (Navegación migas de pan) */}
    <div class="flex items-center gap-2 text-sm text-zinc-500 mb-8">
        <a href="/" class="hover:text-white transition-colors">Inicio</a>
        <ChevronRightIcon className="w-3 h-3" />
        <span class="text-zinc-400">{section.title}</span>
        <ChevronRightIcon className="w-3 h-3" />
        <span class="text-blue-400 font-medium">{title}</span>
    </div>

    <div class="grid grid-cols-1 xl:grid-cols-12 gap-12 lg:gap-20">
        
        {/* Columna Izquierda: Contenido Principal */}
        <div class="xl:col-span-7">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6 tracking-tight leading-tight">
                {title}
            </h1>
            
            {techBadge && (
                <div class="mb-8 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-orange-500/10 border border-orange-500/20 text-orange-400 font-medium text-sm">
                   <WrenchScrewdriverIcon className="w-4 h-4" />
                   {techBadge}
                </div>
            )}

            <div class="prose prose-invert prose-lg max-w-none mb-12">
                <p class="text-lg md:text-xl text-zinc-300 leading-relaxed font-light">
                   {fullDescription}
                </p>
            </div>

            {/* Grid de Características */}
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-12">
                {features.map((feature) => (
                    <div class="flex items-start gap-3 p-3 rounded-lg bg-zinc-900/30 border border-zinc-800/50">
                        <CheckCircleIcon className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
                        <span class="text-zinc-300 text-sm font-medium">{feature}</span>
                    </div>
                ))}
            </div>
            
            {/* Plan de Implementación (Estático) */}
            <div class="bg-zinc-900/20 border border-zinc-800 rounded-3xl p-8">
                <h3 class="text-2xl font-bold text-white mb-8 flex items-center gap-2">
                    <ClockIcon className="w-6 h-6 text-blue-500" />
                    Plan de Implementación
                </h3>
                <div class="space-y-0 relative">
                    {/* Línea Vertical Conectora */}
                    <div class="absolute left-[19px] top-2 bottom-4 w-0.5 bg-zinc-800"></div>

                    {implementationPlan.map((step) => (
                       <div class="relative flex gap-6 mb-8 last:mb-0 group">
                           <div class="relative z-10 flex-shrink-0 w-10 h-10 rounded-full bg-zinc-900 border-2 border-zinc-700 group-hover:border-blue-500 group-hover:bg-blue-900/20 transition-colors flex items-center justify-center text-sm font-bold text-zinc-400 group-hover:text-blue-400">
                               {step.step}
                           </div>
                           <div class="pt-1">
                               <h4 class="text-white font-bold text-lg mb-1 group-hover:text-blue-400 transition-colors">{step.title}</h4>
                               <p class="text-zinc-400 text-sm leading-relaxed">{step.description}</p>
                           </div>
                       </div>
                    ))}
                </div>
            </div>

            {/* INTERACTIVIDAD: Gantt Chart (Componente React) */}
            <div class="mt-12">
                <ProjectGantt client:visible steps={implementationPlan} />
            </div>

            <div class="mt-12">
                <a 
                   href="/contacto"
                   class="inline-block px-8 py-4 w-full sm:w-auto bg-white text-black font-bold rounded-xl hover:bg-zinc-200 transition-colors text-center"
                >
                    Solicitar Consultoría
                </a>
            </div>
        </div>

        {/* Columna Derecha: Imagen Destacada */}
        <div class="xl:col-span-5">
            <div class="sticky top-8 space-y-6">
               <div class="relative group perspective-1000">
                   <div class="absolute -inset-1 bg-gradient-to-r from-blue-500 to-purple-600 rounded-3xl blur opacity-20 group-hover:opacity-40 transition duration-1000"></div>
                   <div class="relative rounded-3xl overflow-hidden border border-zinc-800 bg-zinc-900 aspect-[3/4] shadow-2xl">
                       {image && (
                           <img 
                               src={image} 
                               alt={title}
                               class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700"
                           />
                       )}
                       {!image && (
                           <div class="w-full h-full flex items-center justify-center bg-zinc-900 text-zinc-700">
                               <span class="text-sm">Imagen no disponible</span>
                           </div>
                       )}
                       
                       {/* Overlay Gradient */}
                       <div class="absolute inset-0 bg-gradient-to-t from-zinc-950 via-transparent to-transparent opacity-80"></div>
                       
                       <div class="absolute bottom-8 left-8 right-8">
                           <p class="text-white font-medium text-lg italic">
                               "{shortDescription}"
                           </p>
                       </div>
                   </div>
               </div>
            </div>
        </div>

    </div>
  </div>
</Layout>