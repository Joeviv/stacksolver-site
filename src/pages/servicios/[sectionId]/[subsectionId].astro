---
// ARCHIVO: src/pages/servicios/[sectionId]/[subsectionId].astro
import Layout from "../../../layouts/Layout.astro";
import { SERVICES_MENU } from "../../../data/menuData";
import { ProjectGantt } from "../../../components/ProjectGantt";
import {
    CheckCircleIcon,
    ClockIcon,
    WrenchScrewdriverIcon,
    ChevronRightIcon,
} from "@heroicons/react/24/outline";

// 1. Generación de rutas estáticas (SEO Friendly)
export async function getStaticPaths() {
    const paths = [];

    SERVICES_MENU.forEach((section) => {
        section.subsections.forEach((sub) => {
            paths.push({
                params: {
                    sectionId: section.id,
                    subsectionId: sub.id,
                },
                props: {
                    section,
                    subsection: sub,
                },
            });
        });
    });

    return paths;
}

// 2. Obtener datos de la página actual
const { section, subsection } = Astro.props;
const {
    title,
    fullDescription,
    features,
    image,
    implementationPlan,
    techBadge,
    shortDescription,
    videoId,
} = subsection;
---

<Layout
    title={`${title} | StackSolver Services`}
    description={shortDescription}
>
    <div
        class="p-6 md:p-12 lg:p-16 max-w-7xl mx-auto w-full animate-in fade-in duration-500"
    >
        {/* Breadcrumbs (Navegación migas de pan) */}
        <div class="flex items-center gap-2 text-sm text-zinc-500 mb-8">
            <a
                href="/"
                class="hover:text-zinc-900 dark:hover:text-white transition-colors"
                >Inicio</a
            >
            <ChevronRightIcon className="w-3 h-3" />
            <span class="text-zinc-400 dark:text-zinc-500">{section.title}</span
            >
            <ChevronRightIcon className="w-3 h-3" />
            <span class="text-blue-600 dark:text-blue-400 font-medium"
                >{title}</span
            >
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-12 lg:gap-20">
            {/* Columna Izquierda: Contenido Principal */}
            <div class="xl:col-span-7">
                <h1
                    class="text-4xl md:text-5xl lg:text-6xl font-bold text-zinc-900 dark:text-white mb-6 tracking-tight leading-tight"
                >
                    {title}
                </h1>

                {
                    techBadge && (
                        <div class="mb-8 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-orange-500/10 border border-orange-500/20 text-orange-400 font-medium text-sm">
                            <WrenchScrewdriverIcon className="w-4 h-4" />
                            {techBadge}
                        </div>
                    )
                }

                <div class="prose prose-invert prose-lg max-w-none mb-12">
                    <p
                        class="text-lg md:text-xl text-zinc-600 dark:text-zinc-300 leading-relaxed font-light"
                    >
                        {fullDescription}
                    </p>
                </div>

                {/* Grid de Características (Vertical list) */}
                <div class="grid grid-cols-1 gap-6 mb-12">
                    {
                        features.map((feature) => (
                            <div class="flex items-start gap-4 p-6 rounded-2xl bg-white dark:bg-zinc-900/30 border border-zinc-200 dark:border-zinc-800/50 shadow-sm dark:shadow-none hover:border-blue-500/30 transition-colors">
                                <CheckCircleIcon className="w-6 h-6 text-green-600 dark:text-green-500 flex-shrink-0 mt-1" />
                                <div class="flex flex-col gap-1">
                                    <span class="text-zinc-900 dark:text-white text-lg font-bold">
                                        {typeof feature === "string"
                                            ? feature
                                            : feature.title}
                                    </span>
                                    {typeof feature !== "string" && (
                                        <p class="text-base text-zinc-600 dark:text-zinc-400 leading-relaxed">
                                            {feature.description}
                                        </p>
                                    )}
                                </div>
                            </div>
                        ))
                    }
                </div>

                {/* Plan de Implementación moved to full width below */}

                {/* Gantt moved to full width below */}

                <div class="mt-12">
                    <a
                        href="/contacto"
                        class="inline-block px-8 py-4 w-full sm:w-auto bg-zinc-900 text-white hover:bg-zinc-800 dark:bg-white dark:text-black font-bold rounded-xl dark:hover:bg-zinc-200 transition-colors text-center"
                    >
                        Solicitar Consultoría
                    </a>
                </div>
            </div>

            {/* Columna Derecha: Imagen/Video Destacada */}
            <div class="xl:col-span-5">
                <div class="space-y-6">
                    <div class="relative group perspective-1000">
                        {
                            videoId ? (
                                <div class="relative rounded-3xl overflow-hidden border border-zinc-200 dark:border-zinc-800 bg-zinc-900 aspect-video shadow-2xl">
                                    <iframe
                                        src={`https://player.vimeo.com/video/${videoId}?badge=0&autopause=0&player_id=0&app_id=58479&background=1`}
                                        class="w-full h-full"
                                        frameborder="0"
                                        allow="autoplay; fullscreen; picture-in-picture"
                                        title={title}
                                    />
                                </div>
                            ) : (
                                <>
                                    <div class="absolute -inset-1 bg-gradient-to-r from-blue-500 to-purple-600 rounded-3xl blur opacity-20 group-hover:opacity-40 transition duration-1000" />
                                    <div class="relative rounded-3xl overflow-hidden border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 aspect-[3/4] shadow-2xl">
                                        {image && (
                                            <img
                                                src={image}
                                                alt={title}
                                                class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700"
                                            />
                                        )}
                                        {!image && (
                                            <div class="w-full h-full flex items-center justify-center bg-zinc-100 dark:bg-zinc-900 text-zinc-400 dark:text-zinc-700">
                                                <span class="text-sm">
                                                    Imagen no disponible
                                                </span>
                                            </div>
                                        )}

                                        {/* Overlay Gradient */}
                                        <div class="absolute inset-0 bg-gradient-to-t from-white/90 dark:from-zinc-950 via-transparent to-transparent opacity-80" />

                                        <div class="absolute bottom-8 left-8 right-8">
                                            <p class="text-zinc-900 dark:text-white font-medium text-lg italic">
                                                "{shortDescription}"
                                            </p>
                                        </div>
                                    </div>
                                </>
                            )
                        }
                    </div>
                </div>
            </div>
        </div>

        {/* FULL WIDTH SECTION: Roadmap & Details */}
        <div class="mt-24 border-t border-zinc-200 dark:border-zinc-800 pt-16">
            <h2
                class="text-3xl md:text-4xl font-bold text-zinc-900 dark:text-white mb-16 text-center"
            >
                Ruta de Transformación Digital
            </h2>

            {/* 1. Horizontal Steps Flow */}
            <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-24 relative"
            >
                {/* Connecting Line (Desktop) */}
                <div
                    class="hidden lg:block absolute top-8 left-0 w-full h-0.5 bg-zinc-200 dark:bg-zinc-800 -z-10"
                >
                </div>

                {
                    implementationPlan.map((step) => (
                        <div class="relative group">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-16 h-16 rounded-2xl bg-white dark:bg-zinc-900 border-2 border-zinc-200 dark:border-zinc-800 group-hover:border-blue-500 group-hover:scale-110 transition-all duration-300 flex items-center justify-center text-xl font-bold text-zinc-400 group-hover:text-blue-600 dark:group-hover:text-blue-400 mb-6 shadow-sm z-10">
                                    {step.step}
                                </div>
                                <h3 class="text-xl font-bold text-zinc-900 dark:text-white mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                                    {step.title}
                                </h3>
                                <p class="text-zinc-500 dark:text-zinc-400 text-sm px-4">
                                    {step.description}
                                </p>
                            </div>
                        </div>
                    ))
                }
            </div>

            {/* 2. Interactive Gantt */}
            <div class="max-w-5xl mx-auto mb-24">
                <h3
                    class="text-2xl font-bold text-zinc-900 dark:text-white mb-8 text-center flex items-center justify-center gap-2"
                >
                    <ClockIcon className="w-6 h-6 text-blue-500" />
                    Cronograma de Ejecución
                </h3>
                <ProjectGantt client:visible steps={implementationPlan} />
                <p
                    class="text-center text-zinc-500 dark:text-zinc-400 mt-4 text-sm"
                >
                    * Metodología ágil: Entregas continuas cada 2 semanas.
                </p>
            </div>

            {/* 3. Detailed Phase Description */}
            <div
                class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-6xl mx-auto"
            >
                {
                    implementationPlan.map((step) => (
                        <div class="bg-zinc-50 dark:bg-zinc-900/50 rounded-3xl p-8 border border-zinc-100 dark:border-zinc-800/50 hover:border-blue-500/30 transition-colors">
                            <div class="flex items-center gap-4 mb-4">
                                <span class="text-xs font-bold uppercase tracking-wider text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 px-3 py-1 rounded-full">
                                    Fase {step.step}
                                </span>
                                <h4 class="text-lg font-bold text-zinc-900 dark:text-white">
                                    {step.title}
                                </h4>
                            </div>
                            <p class="text-zinc-600 dark:text-zinc-300 leading-relaxed text-sm">
                                {step.longDescription || step.description}
                            </p>
                        </div>
                    ))
                }
            </div>
        </div>
    </div>
</Layout>
