---
// ARCHIVO: src/pages/servicios/[sectionId]/index.astro
import Layout from "../../../layouts/Layout.astro";
import { SERVICES_MENU } from "../../../data/menuData";
import {
    ChevronRightIcon,
    PlayIcon,
    ArrowLongRightIcon,
} from "@heroicons/react/24/outline";

export const prerender = true;

// 1. Generación de rutas estáticas para cada Sección Principal (ej: /servicios/ai-local)
export async function getStaticPaths() {
    return SERVICES_MENU.map((section) => ({
        params: {
            sectionId: section.id,
        },
        props: {
            section,
        },
    }));
}

const { section } = Astro.props;
const { title, subsections } = section;

// Función auxiliar para obtener descripción (si existiera en Section, por ahora hardcodeada o derivada)
const getDescription = (id: string) => {
    switch (id) {
        case "ai-local":
            return "Soluciones avanzadas de Inteligencia Artificial que operan 100% en su infraestructura. Soberanía de datos, máxima seguridad y rendimiento sin latencia.";
        case "enterprise":
            return "Sistemas empresariales robustos (ERP, CRM) diseñados para escalar con su negocio. Centralice operaciones y tome decisiones basadas en datos.";
        case "grc":
            return "Gobernanza, Riesgo y Cumplimiento. Plataformas para asegurar la integridad de su organización, cumplir normativas y gestionar riesgos proactivamente.";
        case "data":
            return "Transforme datos brutos en decisiones inteligentes. Dashboards, minería de datos y analítica predictiva para visualizar el futuro de su empresa.";
        case "web":
            return "Experiencias digitales de alto impacto. Desde el diseño UX/UI hasta el desarrollo de e-commerce y plataformas web de alto rendimiento.";
        case "lms":
            return "Plataformas de aprendizaje corporativo y académico. Capacite a su equipo con tecnología SCORM, gamificación y analítica educativa.";
        default:
            return "Soluciones tecnológicas integrales.";
    }
};

const fullDescription = getDescription(section.id);

const videoMapping: Record<string, string> = {
    enterprise: "1134880582",
    grc: "1152285799",
    "ai-local": "1152338281",
};
const videoId = videoMapping[section.id];
---

<Layout title={`${title} | StackSolver Services`}>
    <div
        class="p-6 md:p-12 lg:p-16 max-w-7xl mx-auto w-full animate-in fade-in duration-500"
    >
        {/* Breadcrumbs */}
        <div class="flex items-center gap-2 text-sm text-zinc-500 mb-8">
            <a
                href="/"
                class="hover:text-zinc-900 dark:hover:text-white transition-colors"
                >Inicio</a
            >
            <ChevronRightIcon className="w-3 h-3" />
            <span class="text-blue-600 dark:text-blue-400 font-medium"
                >{title}</span
            >
        </div>

        {/* Encabezado Principal */}
        <div class="max-w-3xl mb-12">
            <h1
                class="text-4xl md:text-5xl lg:text-6xl font-bold text-zinc-900 dark:text-white mb-6 tracking-tight"
            >
                {title}
            </h1>
            <p
                class="text-xl text-zinc-600 dark:text-zinc-300 leading-relaxed font-light"
            >
                {fullDescription}
            </p>
        </div>

        {/* VIDEO SECTION - Full Width */}
        <div
            class="w-full aspect-video rounded-3xl overflow-hidden shadow-2xl bg-zinc-900 border border-zinc-800 relative group mb-20"
        >
            {
                /* Placeholder Overlay - Visible si no hay iframe o mientras carga */
            }
            <div
                class="absolute inset-0 flex items-center justify-center pointer-events-none z-10"
            >
                <div
                    class="bg-white/10 backdrop-blur-sm p-6 rounded-full border border-white/20 shadow-xl group-hover:scale-110 transition-transform duration-500"
                >
                    <PlayIcon className="w-12 h-12 text-white opacity-90" />
                </div>
            </div>

            {/* VIMEO PLAYER CONTAINER */}
            {
                /* 
                INSTRUCCIONES PARA USUARIO:
                Reemplace el src del iframe con su enlace de embed de Vimeo.
                Recomendado: ?background=1 para autoplay/loop/mute sin controles.
            */
            }
            {
                (() => {
                    if (videoId) {
                        return (
                            <iframe
                                src={`https://player.vimeo.com/video/${videoId}?badge=0&autopause=0&player_id=0&app_id=58479&background=1`}
                                class="w-full h-full"
                                frameborder="0"
                                allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share"
                                allowfullscreen
                                title={`Video ${title}`}
                            />
                        );
                    } else {
                        return (
                            <iframe
                                src="https://player.vimeo.com/video/PLACEHOLDER_ID?background=1"
                                class="w-full h-full"
                                frameborder="0"
                                allow="autoplay; fullscreen; picture-in-picture"
                                allowfullscreen
                                title="Presentación del Servicio"
                            />
                        );
                    }
                })()
            }
        </div>

        {/* Listado de Sub-Servicios (Cards) */}
        <h2 class="text-3xl font-bold text-zinc-900 dark:text-white mb-8">
            Nuestras Soluciones en {title}
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {
                subsections.map((sub) => (
                    <a
                        href={`/servicios/${section.id}/${sub.id}`}
                        class="group relative flex flex-col p-8 bg-zinc-50 dark:bg-zinc-900/50 rounded-3xl border border-zinc-200 dark:border-zinc-800 hover:border-blue-500/50 dark:hover:border-blue-500/50 transition-all duration-300 hover:shadow-lg dark:hover:shadow-blue-900/5"
                    >
                        <div class="mb-4 text-zinc-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                            <h3 class="text-xl font-bold">{sub.title}</h3>
                        </div>

                        <p class="text-zinc-600 dark:text-zinc-400 text-sm leading-relaxed mb-6 flex-grow">
                            {sub.shortDescription}
                        </p>

                        <div class="flex items-center text-blue-600 dark:text-blue-400 text-sm font-medium">
                            Ver detalles
                            <ArrowLongRightIcon className="w-4 h-4 ml-2 transform group-hover:translate-x-1 transition-transform" />
                        </div>
                    </a>
                ))
            }
        </div>
    </div>
</Layout>
